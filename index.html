<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1e1e1e">
  <title>Card Tracker</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-180.png">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ── Tab Bar ── -->
<nav class="tab-bar">
  <button data-tab="browse" class="active">Browse</button>
  <button data-tab="session">Session</button>
  <button data-tab="pending">Pending <span id="pendingBadge" class="badge" style="display:none">0</span></button>
  <button data-tab="settings">Settings</button>
</nav>

<!-- ═══════════ BROWSE PANEL ═══════════ -->
<div id="browsePanel" class="panel active">
  <div class="control-group">
    <label>Sport</label>
    <select id="sportSelect"><option value="">-- Load catalog first --</option></select>

    <label>Product</label>
    <select id="productSelect"><option value="">--</option></select>

    <label>Set</label>
    <select id="setSelect"><option value="">--</option></select>
  </div>

  <div class="search-bar">
    <input id="cardSearch" type="text" placeholder="Search player name...">
  </div>

  <div id="cardList" class="card-list">
    <div class="empty-state">
      <div class="icon">&#x1F4E6;</div>
      <p>Load a catalog from the Settings tab to get started.</p>
    </div>
  </div>
</div>

<!-- ═══════════ SESSION PANEL ═══════════ -->
<div id="sessionPanel" class="panel">

  <!-- Setup view (shown when no session active) -->
  <div id="sessionSetup">
    <div class="control-group">
      <h3 style="margin-bottom:12px">Start a Session</h3>
      <p style="font-size:13px; color:var(--text2); margin-bottom:16px;">
        Pick a product and location, then rapidly tap cards to add them.
      </p>

      <label>Sport</label>
      <select id="sessSportSelect"><option value="">--</option></select>

      <label>Product</label>
      <select id="sessProductSelect"><option value="">--</option></select>

      <label>Sets</label>
      <p class="setup-hint">Tap to include in your session.</p>
      <div class="multi-select-actions">
        <button class="link-btn" id="sessSetSelectAll">Select All</button>
        <button class="link-btn" id="sessSetClear">Clear</button>
      </div>
      <div id="sessSetPicker" class="tag-group"></div>

      <label>Parallels</label>
      <p class="setup-hint">Union of parallels across selected sets.</p>
      <div class="multi-select-actions">
        <button class="link-btn" id="sessParSelectAll">Select All</button>
        <button class="link-btn" id="sessParClear">Clear</button>
      </div>
      <div id="sessParallelPicker" class="tag-group"></div>

      <label>Location</label>
      <div id="sessLocationPicker" class="tag-group"></div>

      <div style="margin-top:20px">
        <button id="startSessionBtn" class="btn btn-green">Start Session</button>
      </div>
    </div>
  </div>

  <!-- Active view (shown during session) -->
  <div id="sessionActive" style="display:none; flex-direction:column; height:100%">
    <div class="sess-header">
      <div class="sess-header-info">
        <span id="sessProductLabel" class="sess-label"></span>
        <span id="sessLocationLabel" class="sess-chip sess-chip-loc"></span>
        <span id="sessCountLabel" class="sess-chip sess-chip-count">0 added</span>
      </div>
      <button id="endSessionBtn" class="btn btn-red" style="width:auto; padding:6px 12px; font-size:13px;">End</button>
    </div>

    <!-- Parallel quick-switcher -->
    <div class="sess-bar">
      <div id="sessParallelBar" class="sess-chips-scroll"></div>
    </div>

    <!-- Set tabs -->
    <div class="sess-bar">
      <div id="sessSetBar" class="sess-chips-scroll"></div>
    </div>

    <!-- Search within session -->
    <div class="search-bar">
      <input id="sessCardSearch" type="text" placeholder="Search player or card #...">
    </div>

    <!-- Card list -->
    <div id="sessCardList" class="card-list"></div>

    <!-- Undo button -->
    <button id="undoBtn" class="sess-undo-btn" style="display:none">Undo</button>
  </div>
</div>

<!-- ═══════════ PENDING PANEL ═══════════ -->
<div id="pendingPanel" class="panel">
  <div id="pendingList" class="card-list">
    <div class="empty-state">
      <div class="icon">&#x2705;</div>
      <p>No pending changes. Browse cards and tap to add them.</p>
    </div>
  </div>
  <div style="padding:12px 16px; display:flex; gap:8px;">
    <button id="exportBtn" class="btn btn-green" style="flex:1">Export Changes</button>
    <button id="clearBtn" class="btn btn-red" style="flex:0 0 auto; width:100px;">Clear All</button>
  </div>
</div>

<!-- ═══════════ SETTINGS PANEL ═══════════ -->
<div id="settingsPanel" class="panel">
  <div class="settings-section">
    <h3>Catalog</h3>
    <div id="catalogInfo" class="catalog-info">No catalog loaded.</div>
    <input type="file" id="catalogFile" accept=".json" style="display:none">
    <button id="loadCatalogBtn" class="btn">Load Catalog JSON</button>
  </div>
  <div class="settings-section">
    <h3>Export</h3>
    <p style="font-size:13px; color:var(--text2); margin-bottom:12px;">
      After adding cards, go to the Pending tab and tap Export to generate a
      changes file you can bring back to your desktop.
    </p>
  </div>
</div>

<!-- ═══════════ ADD CARD SHEET ═══════════ -->
<div id="sheetOverlay" class="sheet-overlay"></div>
<div id="addSheet" class="sheet">
  <div class="sheet-handle"></div>
  <h3 id="sheetTitle">Add Card</h3>
  <div id="sheetSubtitle" class="subtitle"></div>

  <div class="sheet-top-row">
    <div>
      <label>Quantity</label>
      <div class="stepper">
        <button id="qtyDown">−</button>
        <input id="qtyInput" class="qty" type="number" value="1" min="1" max="99">
        <button id="qtyUp">+</button>
      </div>
    </div>
    <button id="confirmAddBtn" class="btn btn-green sheet-add-btn">Add</button>
  </div>

  <label>Parallel <button class="lock-btn" data-field="parallel" title="Lock">&#x1F513;</button></label>
  <div id="parallelPicker" class="tag-group"></div>

  <label>Serial Number</label>
  <input id="serialInput" type="text" placeholder="e.g. 23/50">

  <label>Grade <button class="lock-btn" data-field="grade" title="Lock">&#x1F513;</button></label>
  <select id="gradeSelect">
    <option value="">Raw (ungraded)</option>
    <option>PSA 10</option><option>PSA 9</option><option>PSA 8</option>
    <option>BGS 10</option><option>BGS 9.5</option><option>BGS 9</option>
    <option>SGC 10</option><option>CGC 10</option>
  </select>

  <label>Location <button class="lock-btn" data-field="location" title="Lock">&#x1F513;</button></label>
  <div id="locationPicker" class="tag-group"></div>

  <label>Price Bucket <button class="lock-btn" data-field="price_bucket" title="Lock">&#x1F513;</button></label>
  <div id="pricePicker" class="tag-group"></div>

  <label>Status <button class="lock-btn" data-field="status" title="Lock">&#x1F513;</button></label>
  <div id="statusPicker" class="tag-group"></div>

  <label>Notes</label>
  <input id="notesInput" type="text" placeholder="Optional notes...">

  <div class="unlock-all-row">
    <button id="unlockAllBtn" class="link-btn" style="display:none">Unlock All Fields</button>
  </div>
</div>

<script type="module" src="app.js"></script>
</body>
</html>
